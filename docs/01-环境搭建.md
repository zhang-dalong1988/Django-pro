# 环境搭建

## Django

**准备工作**

1. 创建示例代码存放目录；
2. 创建并激活 Python 虚拟环境。

```bash
# 创建示例代码存放目录
$ mkdir code
# 创建虚拟环境
$ python -m venv .venv
# 激活虚拟环境
$ source .venv/bin/activate
# 退出虚拟环境
$ deactivate
```

---

**安装 Django**

```bash
$ pip install django
```

---

**创建 Django 项目**

```bash
# 创建项目目录
$ mkdir -p ch1-hello-django

# 创建 Django 项目
$ cd ch1-hello-django
$ django-admin startproject django_project .
```

---

**启动开发服务器**

```bash
# 迁移数据库
$ python manage.py migrate
# 启动开发服务器
$ python manage.py runserver
```

> 此时如果一切正常，在浏览器中访问 http://127.0.0.1:8000/ ，应该会看到 Django 的欢迎页面。

---

**创建第一个应用 pages**

```bash
# 创建应用
$ python manage.py startapp pages
```

注册/安装应用

```python
# django_project/settings.py
INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    # 本地应用
    "pages.apps.PagesConfig",  # 新增
]
```

> 注意：Django 从上到下加载应用，所以一般来说，最好将新应用添加到它们可能依赖的内置应用（如`admin`、`auth`等）之下。

配置项目路由

```python
# django_project/urls.py
from django.contrib import admin
from django.urls import path, include  # 新增

urlpatterns = [
    path("admin/", admin.site.urls),
    path("", include("pages.urls")),  # 新增
]
```

修改视图

```python
# pages/views.py
from django.http import HttpResponse


def home_page_view(request):
    return HttpResponse("Hello, World!")
```

配置应用路由：在 pages 应用中创建 urls.py 文件

```python
# pages/urls.py
from django.urls import path

from .views import home_page_view

urlpatterns = [
    path("", home_page_view, name="home")
]
```

---

**验证工作**

```bash
# 启动开发服务器
$ python manage.py runserver
```

## requirements

```bash
$ pip freeze > requirements.txt
```

## Docker

**Dockerfile** -- 它定义了创建和运行自定义镜像的步骤

在项目目录下创建 Dockerfile 文件

```dockerfile
# === 获取基础镜像 ===
FROM python:3.13.5-slim-bullseye

# === 设置环境变量 ===
# 禁用 pip 版本检查
ENV PIP_DISABLE_PIP_VERSION_CHECK=1
# 禁用 Python 字节码缓存
ENV PYTHONDONTWRITEBYTECODE=1
# 禁用 Python 缓冲
ENV PYTHONUNBUFFERED=1

# === 设置工作目录 ===
# 设置根目录下的 code 为工作目录，后续所有命令都将在该目录下执行
# 例如：COPY ./requirements.txt . 将把 requirements.txt 文件复制到 /code 目录下
WORKDIR /code

# === 执行命令 ===
# 安装依赖
COPY ./requirements.txt .
RUN pip install -r requirements.txt
# 复制项目代码
COPY . .
```

---

**.dockerignore** -- 它定义了哪些文件和目录应该被忽略，从而避免将不必要的文件添加到镜像中

在项目目录下创建 .dockerignore 文件

```dockerignore
.venv
.git
.gitignore
```

---

**docker-compose.yml** -- 它定义了如何组合服务来创建容器

在项目目录下创建 docker-compose.yml 文件

```yaml
# 项目名称：用于标识 Docker Compose 项目，影响网络名称和容器前缀
name: hello-django

# === 服务定义 ===
services:
  # web 服务：定义 Django 应用的 Web 服务容器
  web:
    # 构建配置：使用当前目录的 Dockerfile 构建自定义镜像
    # 这将执行 Dockerfile 中定义的所有步骤来创建镜像
    build: .

    # 端口映射配置：将容器内的 8000 端口映射到主机的 8000 端口
    # 格式为 "主机端口:容器端口"，使得可以通过 localhost:8000 访问应用
    ports:
      - "8000:8000"

    # 容器启动命令：容器启动时将执行的命令
    # python manage.py runserver 0.0.0.0:8000 启动 Django 开发服务器
    # 0.0.0.0 表示监听所有网络接口，允许从容器外部访问应用
    # 如果使用 127.0.0.1，则只能从容器内部访问
    command: python manage.py runserver 0.0.0.0:8000

    # 卷挂载配置：将主机目录挂载到容器内的指定路径
    # "." 表示当前目录（项目根目录），":/code" 表示挂载到容器内的 /code 目录
    # 这实现了代码热更新：在主机上修改代码后，容器内立即可见，无需重启容器
    # 同时保证容器停止后，数据不会丢失
    volumes:
      - .:/code
```

---

**启动 Docker 容器**

```bash
$ docker-compose up
```

> 此时如果一切正常，在浏览器中访问 http://127.0.0.1:8000/ ，应该会看到 Django 的欢迎页面。

使用 `Control+c` 停止容器运行

```bash
# 删除容器
$ docker-compose down
```

## Git

**.gitignore** -- 它定义了哪些文件和目录应该被忽略，从而避免将不必要的文件添加到 Git 仓库中

在项目目录下创建 .gitignore 文件

```gitignore
.venv
__pycache__/
db.sqlite3
# 仅限 Mac
.DS_Store
```

```bash
$ git add .
$ git commit -m 'ch1-环境搭建'
```
